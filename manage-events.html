<!DOCTYPE html>
<html lang="en" class="bg-slate-950 text-white">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Manage Events</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen">
  <div class="relative isolate overflow-hidden min-h-screen">
    <div class="absolute inset-0 -z-10 bg-[radial-gradient(circle_at_top,_rgba(99,102,241,0.25),_transparent_55%)]"></div>

    <!-- HEADER -->
    <header class="max-w-6xl mx-auto px-6 py-6 flex items-center justify-between">
      <div class="flex items-center gap-3">
        <span class="text-2xl">ðŸ“‹</span>
        <span class="text-lg font-semibold">Manage My Events</span>
      </div>
      <a href="index.html" class="text-sm text-slate-300 hover:text-white">
        Back to Home
      </a>
    </header>

    <!-- MAIN -->
    <main class="max-w-6xl mx-auto px-6 pb-16 pt-6">

      <!-- EMAIL INPUT CARD -->
      <section class="max-w-xl mx-auto bg-white/5 border border-white/10 rounded-3xl p-6 shadow-xl">
        <h2 class="text-xl font-semibold">View your events</h2>
        <p class="mt-1 text-sm text-slate-300">
          Enter the email you used when creating events.
        </p>

        <div class="mt-4 space-y-3">
          <label for="ownerEmail" class="text-sm font-semibold text-slate-200">
            Owner email
          </label>
          <input id="ownerEmail" type="email" required
            placeholder="you@email.com"
            class="w-full rounded-xl border border-white/10 bg-slate-900
                   px-4 py-3 text-white shadow-sm
                   focus:border-indigo-500 focus:outline-none
                   focus:ring-2 focus:ring-indigo-500/30" />

          <button id="loadButton"
            class="w-full rounded-xl bg-indigo-600 py-3
                   text-white font-semibold shadow
                   hover:bg-indigo-500 transition
                   disabled:opacity-60 disabled:cursor-not-allowed">
            Load events
          </button>
        </div>

        <p id="status"
           class="mt-4 text-center text-sm text-slate-300"
           aria-live="polite"></p>
      </section>

      <!-- EVENTS GRID -->
      <section class="mt-10">
        <div id="eventsGrid"
             class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3"></div>
      </section>

    </main>
  </div>

<script>
const API_BASE = "https://event-upload-api.surendra-david-puppala.workers.dev";

document.getElementById("loadButton").addEventListener("click", loadEvents);

async function loadEvents() {
  const emailInput = document.getElementById("ownerEmail");
  const status = document.getElementById("status");
  const grid = document.getElementById("eventsGrid");
  const button = document.getElementById("loadButton");

  const email = emailInput.value.trim();
  if (!email) {
    status.textContent = "Please enter your email.";
    return;
  }

  status.textContent = "Loading eventsâ€¦";
  grid.innerHTML = "";
  button.disabled = true;

  try {
    const res = await fetch(
      `${API_BASE}/api/list-events?owner=${encodeURIComponent(email)}`
    );

    if (!res.ok) {
      status.textContent = "Error loading events.";
      return;
    }

    const data = await res.json();
    const events = Array.isArray(data.events) ? data.events : [];

    if (events.length === 0) {
      status.textContent = "No events found for this email.";
      return;
    }

    status.textContent = "";

    for (const ev of events) {
      grid.appendChild(buildEventCard(ev));
    }
  } catch (err) {
    console.error(err);
    status.textContent = "Network error. Please try again.";
  } finally {
    button.disabled = false;
  }
}

function buildEventCard(ev) {
  const card = document.createElement("div");
  card.className =
    "rounded-2xl bg-white/5 border border-white/10 p-6 shadow-xl " +
    "transition hover:shadow-2xl hover:-translate-y-1";

  const title = document.createElement("h3");
  title.className = "text-xl font-semibold";
  title.textContent = ev.name || "Untitled Event";

  const meta = document.createElement("p");
  meta.className = "mt-1 text-sm text-slate-300";
  meta.textContent = `Event ID: ${ev.id}`;

  const created = document.createElement("p");
  created.className = "mt-1 text-xs text-slate-400";
  created.textContent = `Created: ${ev.created_at}`;

  const actions = document.createElement("div");
  actions.className = "mt-5 flex flex-col gap-3";

  const uploadLink = document.createElement("a");
  uploadLink.href = `/guest-upload.html?eventId=${encodeURIComponent(ev.id)}`;
  uploadLink.className =
    "text-center rounded-lg bg-emerald-600 py-2 text-white " +
    "font-semibold hover:bg-emerald-500 transition";
  uploadLink.textContent = "Open guest upload";

  const adminLink = document.createElement("a");
  adminLink.href = `/event-admin-login.html?eventId=${encodeURIComponent(ev.id)}`;
  adminLink.className =
    "text-center rounded-lg bg-indigo-600 py-2 text-white " +
    "font-semibold hover:bg-indigo-500 transition";
  adminLink.textContent = "Admin login";

  actions.appendChild(uploadLink);
  actions.appendChild(adminLink);

  card.appendChild(title);
  card.appendChild(meta);
  card.appendChild(created);
  card.appendChild(actions);

  return card;
}
</script>

</body>
</html>
