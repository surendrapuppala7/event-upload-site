<!DOCTYPE html>
<html lang="en" class="dark:bg-black dark:text-white">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Upload Event Media</title>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @media (prefers-color-scheme: dark) {
      body { background-color: #000; color: white; }
    }
  </style>
</head>

<body class="min-h-screen flex flex-col items-center p-6">

  <!-- Header -->
  <h1 id="eventName" class="text-2xl font-bold mt-6 text-center"></h1>
  <p id="eventMessage" class="text-gray-600 dark:text-gray-300 mt-2 text-center"></p>

  <!-- Upload Button -->
  <button id="btn"
    class="mt-10 px-8 py-4 bg-indigo-600 hover:bg-indigo-700 text-white text-xl rounded-2xl shadow-lg transition active:scale-95">
    ðŸ“¸ Take Photo / ðŸŽ¥ Record Video
  </button>

  <!-- Status Message -->
  <p id="status" class="mt-6 text-lg font-medium text-center"></p>

  <!-- Loading Spinner -->
  <div id="spinner" class="mt-4 hidden">
    <div class="animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-indigo-500 mx-auto"></div>
    <p class="text-sm mt-2 text-gray-500 dark:text-gray-400">Uploading...</p>
  </div>

<script>
// Read eventId from URL
const params = new URLSearchParams(location.search);
const eventId = params.get("eventId");

if (!eventId) {
  document.getElementById("eventName").innerText = "Invalid event link";
} else {
  document.getElementById("eventName").innerText = "Upload to Event: " + eventId;
  document.getElementById("eventMessage").innerText =
    "Take a photo or record a video to upload.";
}

// Upload Function
async function uploadFile(file) {
  const status = document.getElementById("status");
  const spinner = document.getElementById("spinner");

  spinner.classList.remove("hidden");
  status.textContent = "";

  const form = new FormData();
  form.append("file", file);
  form.append("eventId", eventId);

  const res = await fetch("https://event-upload-api.surendra-david-puppala.workers.dev/", {
    method: "POST",
    body: form
  });

  spinner.classList.add("hidden");

  if (res.ok) {
    status.textContent = "âœ… Uploaded successfully! Thank you!";
    status.className = "mt-6 text-lg font-semibold text-green-500 text-center";
  } else {
    status.textContent = "âŒ Upload failed. Please try again.";
    status.className = "mt-6 text-lg font-semibold text-red-500 text-center";
  }
}

// Trigger Camera Input
document.getElementById("btn").onclick = () => {
  const input = document.createElement("input");
  input.type = "file";
  input.accept = "image/*,video/*";
  input.capture = "environment"; // mobile back camera
  input.onchange = () => uploadFile(input.files[0]);
  input.click();
};
</script>

</body>
</html>
